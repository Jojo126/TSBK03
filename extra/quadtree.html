<html>
	<head>
		<title>Quadtree</title>
	</head>
	<body>
        <script src="../js/three.js"></script>
		<script>
            let scene = new THREE.Scene();
			let camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

			let renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

            const CLOTHWIDTH = 15;
            const CLOTHHEIGHT = 15;
            const WIDTHSEGMENTS = 41;
            const HEIGHTSEGMENTS = 41;
            let planeGeometry = new THREE.PlaneBufferGeometry( CLOTHWIDTH, CLOTHHEIGHT, WIDTHSEGMENTS, HEIGHTSEGMENTS );
            //Information about vertices positions (only to be read)
            let planeVertices = planeGeometry.getAttribute('position');
            console.log(planeVertices);
            
            
            /******************   Create hierarchy for vertices   ******************/
            //create array of indices to use with getX, getY, getZ later
            let counter = 0;
            let indexArray = [];
            for (let i = 1; i <= planeVertices.count; i++) {
                indexArray.push(counter);
                counter++;
                //console.log(array);
            }
            console.log(indexArray);
            
            
            //recusrively divide array into subgroups (only done once!)
            let rowPivot, columnPivot, i;                        
            let divideGroup = (rows, columns, subArray) => {
                rowPivot = Math.ceil(rows/2)*columns; //8
                columnPivot = Math.ceil(columns/2); //2
                
                //console.log("rows: " + rows);
                //console.log("cols: " + columns);
                //console.log("subArray: " + subArray);
                
                //base-case
                if (subArray.length <= 1) {
                    return { vertices: subArray };
                } 
                else {
                    let firstGroup = [];
                    let secondGroup = [];
                    let thirdGroup = [];
                    let fourthGroup = [];
                
                    for(i = 0; i < subArray.length; i++) {
                        //create for new subgroups
                        //send correct array of vertices into groups
                        //första 
                        if(i < rowPivot && i % columns <= columnPivot-1) {
                            firstGroup.push(subArray[i]);
                            //console.log("första för: " + i);
                        }
                        //andra
                        else if(i < rowPivot && i % columns > columnPivot-1) {
                            secondGroup.push(subArray[i]);
                            //console.log("andra för: " + i);
                        }
                        else if(i >= rowPivot && i % columns <= columnPivot-1) {
                            thirdGroup.push(subArray[i]);
                            //console.log("tredje för: " + i);
                        } 
                        else {
                        fourthGroup.push(subArray[i]);
                        //console.log("fjärde för: " + i);
                        }
                    }
                    //console.log("firstgroup: " + firstGroup);
                    //console.log("secondGroup: " + secondGroup);
                    //console.log("thirdGroup: " + thirdGroup);
                    //console.log("fourthGroup: " + fourthGroup);
                    
                    let firstObject = divideGroup(Math.ceil(rows/2), Math.ceil(columns/2), firstGroup);
                    let secondObject = divideGroup(Math.ceil(rows/2), columns - Math.ceil(columns/2), secondGroup);
                    let thirdObject = divideGroup(rows - Math.ceil(rows/2), Math.ceil(columns/2), thirdGroup);
                    let fourthObject = divideGroup(rows - Math.ceil(rows/2), columns - Math.ceil(columns/2), fourthGroup);
                
                    return {
                        vertices: subArray,
                        firstQuadrant: firstObject,
                        secondQuadrant: secondObject,
                        thirdQuadrant: thirdObject,
                        fourthQuadrant: fourthObject
                    };
                }
            }
            
            let root = divideGroup(WIDTHSEGMENTS+1, HEIGHTSEGMENTS+1, indexArray);
            console.log(root);
            
            /**************************/
            
            
            
            let material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
			let cube = new THREE.Mesh( planeGeometry, material );
			scene.add( cube );

			camera.position.z = 5;

			let animate = function () {
				requestAnimationFrame( animate );

				renderer.render( scene, camera );
			};

			animate();
            
            //get vertex in group/leaf
            console.log(root.firstQuadrant.thirdQuadrant.vertices[0]);            
            
        </script>
    </body>
</html>